%!TeX root=../Monografia - Mikhael Pinto.tex
%("dica" para o editor de texto: este arquivo é parte de um documento maior)

% Conteúdo da subseção sobre Localizações
% Este arquivo é importado em 02-implementacao.tex

O desenho do experimento BikeSP especificou que apenas viagens entre localizações pré-cadastradas seriam remuneradas, visando incentivar deslocamentos cotidianos (casa-trabalho, casa-escola) em detrimento de viagens recreacionais irregulares. Durante inscrição via formulário LimeSurvey, participantes forneciam endereços textuais de até três localizações principais (tipicamente residência, trabalho/estudo, e uma terceira opcional). O sistema realizava geocodificação automática destes endereços  --- conversão de texto (``Av. Paulista, 1000, Bela Vista, CEP 01310-100'') para coordenadas GPS (latitude/longitude) utilizando APIs externas de geolocalização.

Para prevenir fraudes (participante alterando localizações para simular viagens longas fictícias), implementou-se regra de uma única alteração por localização após cadastro inicial. Participante que cadastrasse endereço incorreto ou mudasse de residência/trabalho poderia corrigi-lo uma vez via aplicativo; segunda tentativa de alteração seria bloqueada. Essa restrição, embora necessária para integridade experimental, gerou demandas de suporte quando usuários cometiam erros tipográficos ou mudavam endereço legitimamente após já terem usado sua cota de alteração.

A interface administrativa de localizações permite buscar por ID de participante e visualizar todas localizações cadastradas (ID, endereço completo, coordenadas, tipo). Funcionalidade crítica é reset da permissão de alteração: administrador, após validar legitimidade da solicitação via email ou telefone, pode remover o registro que controla alterações de localização, concedendo ao participante nova oportunidade de modificar endereço no aplicativo. Mensagens de feedback (``O usuário agora pode trocar uma localização'' vs. ``Nenhuma alteração de localização foi encontrada'') informam sucesso ou ausência de restrição ativa. Esse procedimento foi utilizado durante o piloto, geralmente após mudanças residenciais ou correções de erros de digitação durante inscrição inicial.

Durante o script de inserção em lote de participantes do LimeSurvey para PostgreSQL, alguns endereços falhavam em geocodificação automática. Causas possíveis incluíam: formatação inconsistente (``Rua X, 100'' vs. ``Rua X|100|...''), abreviações não reconhecidas, bairros incorretos, CEPs inválidos, endereços recém-criados ausentes em bases cartográficas, e timeouts de APIs. Localizações que falhavam geocodificação eram marcadas como ``inválidas'' e ficavam inacessíveis no aplicativo móvel ---  participante visualizava localização na lista mas não podia utilizá-la como origem/destino de viagens, bloqueando efetivamente sua participação.

Esse problema revelou-se crítico: correção manual urgente foi necessária durante o piloto. A funcionalidade de correção de geolocalização tornou-se operação essencial.

A tela de localizações inválidas lista endereços que falharam, exibindo ID, ID do participante, endereço textual, tipo e apelido da localização. Funcionalidades de busca, ordenação e paginação seguem padrão estabelecido em outras telas. Para corrigir, administrador edita endereço diretamente seguindo dois formatos possíveis: (i) endereço estruturado separado por pipe (ex: \texttt{Av. Paulista|1000|sala 5|Bela Vista|01310-100|São Paulo|SP}), submetido novamente às APIs de geocodificação; ou (ii) coordenadas GPS diretas (ex: \texttt{-23.5997136,-46.4677964}), sem precisar passar pela geocodificação quando endereço é intratável por APIs mas localização é conhecida via Google Maps. Validação bem-sucedida remove localização da lista de inválidas, tornando-a imediatamente disponível no aplicativo do participante.

Workflow operacional típico incluía: cópia do endereço para Google Maps, verificação de formatação e bairro correto, ajuste se necessário, validação no sistema. Problemas recorrentes e soluções documentadas: CEPs com dígitos transpostos (buscar CEP correto online); bairros coloquiais vs. oficiais (Pinheiros vs. Alto de Pinheiros); abreviações (``Av.'' expandir para ``Avenida''); endereços inexistentes (usar coordenadas GPS obtidas manualmente). A disponibilidade de múltiplas APIs de geolocalização aumentava taxa de sucesso, mas timeouts ocasionais justificavam opção de inserção direta de coordenadas.

A correção de localizações inválidas foi realizada pela equipe de suporte. Diferentes abordagens foram utilizadas: reformatação com nova geocodificação automática, inserção manual de coordenadas diretas obtidas via Google Maps, ou contato com participante para clarificação de endereço.

Para iterações futuras do programa, recomendações incluem: validação de formato durante preenchimento do formulário LimeSurvey, geocodificação imediata após submissão do formulário com feedback visual ao candidato, e assistente de endereçamento integrado (autocompletar baseado em API de CEPs). A natureza manual e laboriosa da correção em lote demonstrou ser gargalo operacional não escalável: expansão para 10.000 participantes (meta de implementação municipal completa) seria inviável sem automação adicional nesta etapa.


